<!DOCTYPE html>

<html>
<head>
  <title>main-ctrl.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>main-ctrl.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">fetchMainCtrl</span> = -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>A mensagem de carregamento inicial
deve ser atualizada</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        loader = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'masterLoader'</span>)
        p = loader.children[<span class="hljs-number">9</span>]
        p.innerHTML = <span class="hljs-string">"Trabalhando no controlador principal"</span>
<span class="hljs-function">        <span class="hljs-title">MainCtrl</span> = <span class="hljs-params">($rootScope, $http, $location, $route, $<span class="hljs-built_in">window</span>, $cookies, $q, authService, formularioService, boletoService, mainService, toastr)</span>-&gt;</span>
    
                $rootScope.onAccountDadosPessoais = <span class="hljs-function">-&gt;</span>
                        $rootScope.dadosPessoais = <span class="hljs-literal">true</span>
                        $rootScope.configuracoes = <span class="hljs-literal">false</span>
                        $rootScope.vinculaConta = <span class="hljs-literal">false</span>
                        classList = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'dadosPessoais'</span>).classList
                        classList2 = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'configuracoes'</span>).classList
                        classList.add(<span class="hljs-string">'active'</span>)
                        classList.add(<span class="hljs-string">'in'</span>)
                        classList2.remove(<span class="hljs-string">'active'</span>)
                        classList2.remove(<span class="hljs-string">'in'</span>)
                        
                $rootScope.onAccountConfiguracoes = <span class="hljs-function">-&gt;</span>
                        $rootScope.configuracoes = <span class="hljs-literal">true</span>
                        $rootScope.dadosPessoais = <span class="hljs-literal">false</span>
                        $rootScope.vinculaConta = <span class="hljs-literal">false</span>
                        classList = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'configuracoes'</span>).classList
                        classList2 = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'dadosPessoais'</span>).classList
                        classList.add(<span class="hljs-string">'active'</span>)
                        classList.add(<span class="hljs-string">'in'</span>)
                        classList2.add(<span class="hljs-string">'active'</span>)
                        classList2.add(<span class="hljs-string">'in'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h1 id="m-todos-de-autentica-o">Métodos de autenticação</h1>
<h2 id="login">Login</h2>
<h3 id="login-com-um-popup-do-google">login com um popup do google</h3>
<ul>
<li>Dependencias:<ul>
<li>authService</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.loginGoogle = <span class="hljs-function">-&gt;</span>
                        authService.loginGoogle()</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h3 id="login-com-email-e-senha-com-regra-de-acesso">login com email e senha com regra de acesso</h3>
<ul>
<li>Dependencias:<ul>
<li>authService</li>
</ul>
</li>
<li>A mesma regra deve ser aplicada à base de dados</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.loginEmailAndPassword = <span class="hljs-function">-&gt;</span>
                        authService.loginEmailAndPassword(<span class="hljs-string">'input_login_email'</span>,
                                <span class="hljs-string">'input_login_password'</span>,
                                <span class="hljs-regexp">/\w+@itsrio.org|gcravista@gmail.com/</span>)                        


                $rootScope.logout = <span class="hljs-function">-&gt;</span> authService.logout()</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="signin">Signin</h2>
<h3 id="criar-usu-rio-com-email-e-senha-com-um-popup-do-google">Criar usuário com email e senha com um popup do google</h3>
<ul>
<li>Dependencias:<ul>
<li>authService</li>
</ul>
</li>
<li>A mesma regra deve ser aplicada à base de dados</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.createUserWithEmailAndPassword = <span class="hljs-function">-&gt;</span>
                       authService.createUserWithEmailAndPassword(<span class="hljs-string">'input_signup_email'</span>,
                               <span class="hljs-string">'input_signup_senha'</span>,
                                <span class="hljs-regexp">/\w+@itsrio.org|gcravista@gmail.com/</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2 id="senhas">Senhas</h2>
<h3 id="solicita-uma-requisi-o-de-envio-de-troca-de-senha">Solicita uma requisição de envio de troca de senha</h3>
<ul>
<li>Dependencias:<ul>
<li>authService</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.sendPasswordResetEmail = <span class="hljs-function">-&gt;</span>
                        authService.sendPasswordResetEmail(<span class="hljs-string">'reset_login_email'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h3 id="confirma-a-requisi-o-de-envio-de-troca-de-senha">Confirma a requisição de envio de troca de senha</h3>
<ul>
<li>Dependencias:<ul>
<li>authService</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.confirm = <span class="hljs-function">-&gt;</span> <span class="hljs-keyword">if</span> $location.url().match <span class="hljs-regexp">/\/confirm\?mode\=[a-zA-Z0-9]+\&amp;oobCode\=[a-zA-Z0-9\_\-]+\&amp;apiKey\=[a-zA-Z0-9]+/</span> <span class="hljs-keyword">then</span> authService.confirm(<span class="hljs-string">'reset_login_password'</span>, <span class="hljs-string">'reset_login_password_confirm'</span>, $location.search())</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h3 id="adiciona-n-mero-de-telefone">Adiciona número de telefone</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.addPhoneNumber = <span class="hljs-function"><span class="hljs-params">(id)</span>-&gt;</span>
<span class="hljs-function">                        <span class="hljs-title">onVerify</span> = <span class="hljs-params">(verificationId)</span> -&gt;</span>
                                $rootScope.whoisPhoneNumber = <span class="hljs-literal">false</span>
                                $rootScope.confirmationCode = <span class="hljs-literal">true</span>
                                $rootScope.verificationId = verificationId
                                <span class="hljs-built_in">console</span>.log verificationId
                                toastr.success(<span class="hljs-string">"Telefone adicionado"</span>)
                        mainService.applicationVerifier.verify()
                                .<span class="hljs-keyword">then</span> authService.verifyPhone(id)
                                .<span class="hljs-keyword">then</span>(onVerify)
                                .<span class="hljs-keyword">catch</span>(onErr)

                $rootScope.confirmSMSCode = <span class="hljs-function"><span class="hljs-params">(id)</span> -&gt;</span>
                        user = firebase.auth().currentUser
                        code = <span class="hljs-built_in">document</span>.getElementById(id).value
                        tel = PhoneAuthProvider.credential($rootScope.verificationId,code)
<span class="hljs-function">                        <span class="hljs-title">onAddPhoneNumber</span> = -&gt;</span> toastr.info <span class="hljs-string">"Telefone"</span>, <span class="hljs-string">"Número atualizado"</span>
                        user.updatePhoneNumber(tel).<span class="hljs-keyword">then</span>(onAddPhoneNumber).<span class="hljs-keyword">catch</span>(onErr)</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h3 id="envia-um-sms-para-iniciar-o-processo-de-troca-de-senha">Envia um SMS para iniciar o processo de troca de senha</h3>
<ul>
<li>Dependencias:<ul>
<li>authService</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.sendSMS = <span class="hljs-function">-&gt;</span> <span class="hljs-keyword">if</span> $location.url().match <span class="hljs-regexp">/\/confirm\?mode\=[a-zA-Z0-9]+\&amp;oobCode\=[a-zA-Z0-9\_\-]+\&amp;apiKey\=[a-zA-Z0-9]+/</span> <span class="hljs-keyword">then</span> authService.sendSMS(<span class="hljs-string">'reset_login_tel'</span>, $location.search())</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2 id="contas">Contas</h2>
<h3 id="solicita-a-vincula-o-de-uma-conta-google-a-uma-conta-email-senha">Solicita a vinculação de uma conta google a uma conta email+senha</h3>
<ul>
<li>Dependencias:<ul>
<li>authService</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.linkAccount = <span class="hljs-function">-&gt;</span> authService.linkAccount()</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h1 id="intera-es-gr-ficas">Interações gráficas</h1>
<h2 id="menu">Menu</h2>
<h3 id="ao-passar-o-mouse-onhover-qq-menu-deve-expandir">Ao passar o mouse (onhover), qq menu deve expandir</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.onDropdownmenu = <span class="hljs-function"><span class="hljs-params">(what, event)</span>-&gt;</span>
                        event.preventDefault()                     
                        <span class="hljs-built_in">document</span>.getElementById(what).classList.add(<span class="hljs-string">'open'</span>)
                        <span class="hljs-built_in">document</span>.getElementById(what).setAttribute(<span class="hljs-string">'aria-expanded'</span>, <span class="hljs-string">'true'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h3 id="ao-tirar-o-mouse-onhover-menu-deve-retrair">Ao tirar o mouse (onhover), menu deve retrair</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.onDropupmenu = <span class="hljs-function"><span class="hljs-params">(what, event)</span>-&gt;</span>
                        event.preventDefault()
                        <span class="hljs-built_in">document</span>.getElementById(what).classList.remove(<span class="hljs-string">'open'</span>)
                        <span class="hljs-built_in">document</span>.getElementById(what).setAttribute(<span class="hljs-string">'aria-expanded'</span>, <span class="hljs-string">'false'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Esta função auxilia verificar erros de qq natureza</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function">                <span class="hljs-title">onErr</span>  = <span class="hljs-params">(err)</span> -&gt;</span>
                        toastr.error(err.code, err.message)
                        <span class="hljs-built_in">console</span>.error(err.code, err.message)</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h1 id="formul-rios">Formulários</h1>
<h2 id="-formularios-novo">/formularios/novo</h2>
<h3 id="recuperar-um-formulario-typeform">Recuperar um formulario typeform</h3>
<h4 id="e-insere-no-firebase">e insere no firebase</h4>
<ul>
<li>Dependencias:<ul>
<li>formularioService</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.onNovoFormulario = <span class="hljs-function"><span class="hljs-params">(id, groups...)</span> -&gt;</span>
<span class="hljs-function">                        <span class="hljs-title">_onNovo</span> = -&gt;</span>
                                $location.path(<span class="hljs-string">'/formularios'</span>)
                                $<span class="hljs-built_in">window</span>.reload()
                        formularioService.novo(id, groups).<span class="hljs-keyword">then</span>(_onNovo).<span class="hljs-keyword">catch</span>(onErr)</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h2 id="recupera-novamente-um-formul-rio">Recupera novamente um formulário</h2>
<h3 id="recuperar-um-formulario-typeform">Recuperar um formulario typeform</h3>
<h4 id="e-atualiza-no-firebase">e atualiza no firebase</h4>
<ul>
<li>Dependencias:<ul>
<li>formularioService</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.onUpdateFormulario =  <span class="hljs-function"><span class="hljs-params">(uuid)</span> -&gt;</span>
<span class="hljs-function">                        <span class="hljs-title">_onUpdate</span> = -&gt;</span>
                                $location.path(<span class="hljs-string">'/formularios'</span>)
                        formularioService.update(uuid).<span class="hljs-keyword">then</span>(_onUpdate).<span class="hljs-keyword">catch</span>(onErr)</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2 id="-formularios-uuid-delete">/formularios/:uuid/delete</h2>
<h3 id="deleta-do-firebase-um-formulario-typeform">Deleta, do firebase, um formulario typeform</h3>
<ul>
<li>Dependencias:<ul>
<li>formularioService</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.onDeleteFormulario = <span class="hljs-function"><span class="hljs-params">(uuid)</span>-&gt;</span>
<span class="hljs-function">                        <span class="hljs-title">_onDel</span> = -&gt;</span>
                                $location.path(<span class="hljs-string">'/formularios'</span>)
                        _uuid = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'input_typeform_uuid'</span>).value
                        <span class="hljs-keyword">if</span> uuid <span class="hljs-keyword">is</span> _uuid 
                                formularioService.<span class="hljs-keyword">delete</span>(uuid, _uuid).<span class="hljs-keyword">then</span>(_onDel).<span class="hljs-keyword">catch</span>(onErr)
                        <span class="hljs-keyword">else</span>
                                onErr <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"Formulario Error"</span>, <span class="hljs-string">"Invalid uuid"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h2 id="-formularios-uuid-respnse-token">/formularios/:uuid/respnse/:token</h2>
<h3 id="cria-um-boleto">Cria um boleto</h3>
<h4 id="a-partir-de-uma-resposta-espec-fica">a partir de uma resposta específica</h4>
<h5 id="de-um-formul-rio-espec-fico">de um formulário específico</h5>

            </div>
            
            <div class="content"><div class='highlight'><pre>                
                                
                $rootScope.onNovoBoleto = <span class="hljs-function">-&gt;</span>
                        questions = <span class="hljs-built_in">document</span>.getElementsByClassName(<span class="hljs-string">'typeform-question'</span>)
                        answers = <span class="hljs-built_in">document</span>.getElementsByClassName(<span class="hljs-string">'typeform-answer'</span>)
                        data =
                                phone_country_code: <span class="hljs-string">"55"</span>
                                state:<span class="hljs-string">"RJ"</span>
                                country_code: <span class="hljs-string">"BR"</span>
                                value:<span class="hljs-string">'10.00'</span> 

                        <span class="hljs-keyword">for</span> i,q <span class="hljs-keyword">of</span> questions
                                <span class="hljs-keyword">for</span> j,a <span class="hljs-keyword">of</span> answers
                                        <span class="hljs-keyword">if</span> i <span class="hljs-keyword">is</span> j
                                                v = a.innerHTML
                                                <span class="hljs-keyword">switch</span>(q.innerHTML)
                                                        <span class="hljs-keyword">when</span> <span class="hljs-string">'Email'</span> <span class="hljs-keyword">then</span> data[<span class="hljs-string">'billing_info_email'</span>] = v
                                                        <span class="hljs-keyword">when</span> <span class="hljs-string">'Nome'</span> <span class="hljs-keyword">then</span> data[<span class="hljs-string">'first_name'</span>] = v
                                                        <span class="hljs-keyword">when</span> <span class="hljs-string">'Sobrenome'</span> <span class="hljs-keyword">then</span> data[<span class="hljs-string">'second_name'</span>] = v
                                                        <span class="hljs-keyword">when</span> <span class="hljs-string">'Cidade'</span> <span class="hljs-keyword">then</span> data[<span class="hljs-string">'city'</span>] = v
                                                        <span class="hljs-keyword">when</span> <span class="hljs-string">'Telefone'</span> <span class="hljs-keyword">then</span> data[<span class="hljs-string">'phone_national_number'</span>]=v
<span class="hljs-function">                                                
                                        
                         
                        <span class="hljs-title">onBoleto</span> = -&gt;</span> $location.path(<span class="hljs-string">"/formularios"</span>)
                        boletoService.novo($rootScope.currentForm, $rootScope.token, data).<span class="hljs-keyword">then</span>(onBoleto).<span class="hljs-keyword">catch</span>(onErr)</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h2 id="-boletos-invoice">/boletos/:invoice</h2>
<h3 id="envia-por-email-um-boleto-draft-">Envia por email um boleto (DRAFT)</h3>
<p>A partir de uma resposta específica de um formulário específico</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.onSendBoleto = <span class="hljs-function">-&gt;</span>
                        user = firebase.auth().currentUser
                        token = $rootScope.boleto.token
                        id = $rootScope.boleto.invoice
<span class="hljs-function">                        <span class="hljs-title">_onSend</span> = <span class="hljs-params">(result)</span>-&gt;</span> toastr.info(<span class="hljs-string">"Boleto"</span>, <span class="hljs-string">"Boleto <span class="hljs-subst">#{id}</span> enviado"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>BUG angular está chamando duas vezes cada controlador
como medida provisória, checar se o email já foi enviado
para n enviar de novo e causar erro</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        db = firebase.database()
                        db.ref(<span class="hljs-string">"boletos/<span class="hljs-subst">#{$rootScope.currentForm}</span>"</span>).once <span class="hljs-string">'value'</span>, <span class="hljs-function"><span class="hljs-params">(boletos)</span> -&gt;</span>
                                <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> boletos.val()
                                        <span class="hljs-keyword">if</span> b.token <span class="hljs-keyword">is</span> token <span class="hljs-keyword">and</span> b.invoice <span class="hljs-keyword">is</span> id
                                                <span class="hljs-keyword">if</span> b.status <span class="hljs-keyword">is</span> <span class="hljs-string">'DRAFT'</span>
                                                        boletoService.send(token, id).<span class="hljs-keyword">then</span>(_onSend).<span class="hljs-keyword">catch</span>(onErr)</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h3 id="cancela-um-boleto">Cancela um boleto</h3>
<p>Será usado apenas quando o boleto for enviado (SENT)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.onCancelBoleto = <span class="hljs-function">-&gt;</span>
<span class="hljs-function">                        <span class="hljs-title">_onSend</span> = <span class="hljs-params">(result)</span> -&gt;</span> $location.path(<span class="hljs-string">'/formularios'</span>)
                        db = firebase.database()
                        token = $rootScope.boleto.token
                        id = $rootScope.boleto.invoice
                        db.ref(<span class="hljs-string">"boletos/<span class="hljs-subst">#{$rootScope.currentForm}</span>"</span>).once <span class="hljs-string">'value'</span>, <span class="hljs-function"><span class="hljs-params">(boletos)</span> -&gt;</span>
                                <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> boletos.val()
                                        <span class="hljs-keyword">if</span> b.token <span class="hljs-keyword">is</span> token <span class="hljs-keyword">and</span> b.invoice <span class="hljs-keyword">is</span> id
                                                boletoService.cancel($rootScope.boleto.token, $rootScope.boleto.invoice).<span class="hljs-keyword">then</span>(_onSend).<span class="hljs-keyword">catch</span>(onErr)</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <h3 id="cria-um-boleto">Cria um boleto</h3>
<p>Relembra o email ao usuário caso seja notado
uma demora</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $rootScope.onRemindBoleto = <span class="hljs-function">-&gt;</span>
<span class="hljs-function">                        <span class="hljs-title">_onSend</span> = <span class="hljs-params">(result)</span> -&gt;</span>
                                $location.path(<span class="hljs-string">'/formularios'</span>)
                        boletoService.remind($rootScope.token, $rootScope.boleto.invoice)
                                .<span class="hljs-keyword">then</span>(_onSend)
                                .<span class="hljs-keyword">catch</span>(onErr)
                

                $rootScope.onDeleteBoleto = <span class="hljs-function">-&gt;</span>
                        form = $rootScope.currentForm
                        id = $rootScope.boleto.invoice
<span class="hljs-function">                        <span class="hljs-title">_onDelete</span> = -&gt;</span>
                                toastr.success(<span class="hljs-string">"Formulário <span class="hljs-subst">#{form}</span>"</span>, <span class="hljs-string">"Boleto <span class="hljs-subst">#{id}</span> deletado"</span>)
                                $location.path(<span class="hljs-string">'/boletos'</span>)
                                $route.reload()
                        boletoService.<span class="hljs-keyword">delete</span>(form, id).<span class="hljs-keyword">then</span>(_onDelete)</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h1 id="reconhecimento">Reconhecimento</h1>
<p>Somente após reconhecer o login,
o usuário é carregado e a página muda
alguns elementos</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        
                $rootScope.$watch <span class="hljs-string">'user'</span>, <span class="hljs-function"><span class="hljs-params">(newUser, oldUser)</span> -&gt;</span>
                        <span class="hljs-keyword">if</span> $rootScope.user <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">and</span> $location.url().match <span class="hljs-regexp">/^\/$/</span> 
                                $location.path(<span class="hljs-string">'/login'</span>)
                                
                        mainService._on(<span class="hljs-regexp">/^\/confirm\?.*$/</span>)
                                .<span class="hljs-keyword">then</span> mainService.onConfirm
                        
                        mainService._on(<span class="hljs-regexp">/^\/confirm\?.*$/</span>)
                                .<span class="hljs-keyword">then</span> mainService.onConfirm
                                
                        mainService._on(<span class="hljs-regexp">/^\/formularios$/</span>)
                                .<span class="hljs-keyword">then</span> mainService.onFormularios
                                .<span class="hljs-keyword">then</span> (formularios) -&gt;
                                        $rootScope.registeredForms = formularios

                        mainService._on(<span class="hljs-regexp">/^\/formularios\/\w+\/\w+$/</span>)
                                .<span class="hljs-keyword">then</span> mainService.onFormulariosAction
                                .<span class="hljs-keyword">then</span> (result) -&gt;
                                        $rootScope[result.action] = result.val
                                        
                        mainService._on(<span class="hljs-regexp">/^\/formularios\/\w+\/\w+\/[a-zA-Z0-9]+$/</span>)

                                .<span class="hljs-keyword">then</span> mainService.onFormulariosActionToken
                                .<span class="hljs-keyword">then</span> (result) -&gt;
                                        <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">of</span> result
                                                $rootScope[k] = v

                        mainService._on(<span class="hljs-regexp">/^\/boletos$/</span>)
                                .<span class="hljs-keyword">then</span> mainService.onBoletos
                                .<span class="hljs-keyword">then</span> (boletos) -&gt;
                                        $rootScope.boletos = boletos
                                        
                        mainService._on(<span class="hljs-regexp">/^\/boletos\/[a-zA-Z0-9]+$/</span>)
                                .<span class="hljs-keyword">then</span> mainService.onBoletosInvoice
                                .<span class="hljs-keyword">then</span> (boleto) -&gt;
                                        $rootScope.boleto = boleto

                        mainService._on(<span class="hljs-regexp">/^\/conta\/telefone\/vincular/</span>)
                                .<span class="hljs-keyword">then</span> mainService.onVincularPhone
                                .<span class="hljs-keyword">then</span> (result) -&gt;
                                        <span class="hljs-built_in">console</span>.log result</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
